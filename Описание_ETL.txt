Наполнение базы данными из БД bookings осуществляется с помощью задания, состоящего из 3 трансформаций:

1) создание структуры новой базы + представления в bookings, с помощью которого будет производиться заливка данных в таблицу фактов. Поскольку в задаче прописано создать таблицы уже совершенных перелетов, в представлении необходимо прописать условие "where actual_arrival is not null".
Таблица dim_calendar создается с помощью функции generate_series, от условной даты до сегодняшнего дня, получаемого функцией now(). Также добавлены поля для идентификации номера дня недели, номера дня месяца, номера недели в году, номера месяца и номера года.

2) формирование датасетов из базы bookings, маппинг и заливка их в таблицы измерений. Также каждый датасет сохранен в отдельный csv файл.

3) формирование датасета из созданного представления в старой базе и созданной таблицы измерений пассажиров. Это сделано для экономии времени, т.к. в случае обновления по id пассажиров это занимает около получаса. Исходя из этого, целесообразнее сделать join по пассажирам сразу, а обновление по другим параметрам можно делать в процессе трансформации. Следующий шаг select values убирает лишние поля и оставляет только нужные.
Далее с помощью шага "калькулятор" создаются поля с данными по задержке вылетов и прилетов, далее - шаги Combination lookup/update по остальным параметрам. Цель этих шагов - создать корректные внешние ключи по всем полям, чтоб таблица fact_flights имела ссылочную целостность с таблицами измерений.
Перед заливкой данных в таблицу фактов созданные технические поля с id параметров следует переименовать в человекочитаемые поля для финального маппинга. После этого происходит заливка данных в таблицу фактов.

Задача осуществляется при помощи задания потому, что для каждой трансформации необходимо удачное завершение предыдущей трансформации. Следовательно, решить задачу с помощью одной трансформации будет сложно, задание намного более удобно. Для удоства решения задачи SQL скрипт создания структуры базы выполняется не запуском отдельного SQL файла, а внедрен в первый шаг задания.
